<th:block xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layouts/layout.html}">
<head>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />

<script src="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.js"></script>
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
</head>
<th:block layout:fragment="pageCss">
	<style>
		.tui-grid-cell:has(.modified-cell-highlight) {
			/* 부모 셀의 배경색을 덮어씁니다. */
			background-color: #FFE5E5 !important;
			color: #000 !important;
		}

		.modified-cell-highlight {
			background-color: #FFE5E5 !important;
			color: #000 !important;
			width: 100% !important; 
			height: 100% !important;
			padding: 0 !important; /* 내부 패딩을 제거하여 가장자리까지 채움 */
		}
	</style>
</th:block>
<body>
<th:block layout:fragment="content">
	<div class="custom-body container-xxl flex-grow-1 container-p-y">
	 	<div class="nav-align-top mb-4">
	         <ul class="nav nav-tabs" role="tablist">
	           <li class="nav-item">
	             <button type="button" class="nav-link active" role="tab" data-bs-toggle="tab" data-bs-target="#navs-process-tab" aria-controls="navs-process-tab" aria-selected="true">
	               제품별 공정 라우트
	             </button>
	           </li>
	           <li class="nav-item">
	             <button type="button" class="nav-link" role="tab" data-bs-toggle="tab" data-bs-target="#navs-processCode-tab" aria-controls="navs-processCode-tab" aria-selected="false">
	               공정코드관리
	             </button>
	           </li>
	         </ul>
	         <div class="tab-content" >
	           <div class="tab-pane fade show active"  id="navs-process-tab" role="tabpanel">
	           		<h2>제품별 공정 라우트</h2>
					<div class="d-flex justify-content-start">
			            <div class="mb-6 mb-0" style="width: 260px;">
				        	<select  id="processprdId" class="form-select">
				        	    <option value="" selected>제품명(제품코드)</option>
			        	    	<option th:each="item, iterStat : ${prdMstList}" 
										th:value="${item.prdId}" 
										th:text="${item.prdName} +' (' + ${item.prdId} + ')'"
										name="prdId">
								</option>
				        	</select>
				        	  </div>
				         	<div class="mb-6 mb-0" style="width: 280px;margin-left:5px;">
			             		<input type="text" id="routeName" name="routeName" class="form-control"  placeholder="라우트명">
			           	</div>
			           		<button type="button" class="btn btn-primary" onclick="productRouteSearch()" style="margin-left:5px;">조회</button>
					</div>
	           		<div class="d-flex justify-content-end">
						 <div class="col-md-4 text-md-end">
			             	<button type="button" class="btn btn-success ms-1 btn-md-sm" data-bs-toggle="modal" data-bs-target="#route-modal" onclick="openRouteModalForCreate()">+ 신규 라우트</button>
							<button id="modifyProcessRowBtn" class="btn btn-danger btn-md-sm" type="button">삭제</button>
			           	 </div>
					</div>
	             	<br>
	             <div id="processGrid" style="display: grid;margin-right:5px;"></div>
	           </div>
	           <div class="tab-pane fade" id="navs-processCode-tab" role="tabpanel">
	             	<h2>공정 코드 관리</h2>
					<div class="d-flex justify-content-start">
			        	<div class="mb-6 mb-0" style="width: 260px;">
				        	<select  id="processId" class="form-select">
				        	    <option value="" selected>공정ID</option>
			        	    	<option th:each="item, iterStat : ${processIdList}" 
										th:value="${item}" 
										th:text="${item}"
										name="prdId">
								</option>
				        	</select>
				        </div>
				        <div class="mb-6 mb-0" style="width: 280px;margin-left:5px;">
			             	<input type="text" id="processName" name="processName" class="form-control"  placeholder="공정명">
			           	</div>
			           		<button type="button" class="btn btn-primary" onclick="processCodeGridAllSearch()" style="margin-left:5px;">조회</button>
					</div>
				 	<div class="d-flex justify-content-end" style="margin:10px;">
			            <button id="addProcessCodeRowBtn" class="btn btn-primary btn-md-sm" type="button" data-preset="striped" style="margin-right:5px;">추가</button>
						<button id="saveProcessCodeRowBtn" class="btn btn-success btn-md-sm" type="button" style="margin-right:5px;">저장</button>
			  			<button id="modifyProcessCodeRowBtn" class="btn btn-danger btn-md-sm" type="button">신규행삭제</button>
			        </div>
	  				<div id="processCodeGrid" style="display: grid;margin-right:5px;"></div>
	           </div>
	         </div>
       	</div>
	</div>
	
	<!-- 신규라우트 등록 모달 -->
	<div class="modal fade" id="route-modal" tabindex="-1">
	  <div class="modal-dialog modal-xl modal-dialog-scrollable">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="routeModalTitle">라우트 등록</h5>
	        <button class="btn-close" data-bs-dismiss="modal"></button>
	      </div>
	      <div class="modal-body">
	
	        <!-- 라우트 기본정보 -->
	        <div class="border rounded p-3 mb-3 bg-light">
	          <div class="row g-3 small">
	            <div class="col-md-3">
	              <label class="form-label">라우트ID</label>
	              <input type="text" class="form-control" id="modalRouteId" readonly
	                     placeholder="저장 시 자동생성 (예: RT-FRUIT)">
	            </div>
	            <div class="col-md-3">
	              	<label class="form-label">제품코드</label>
	              	<select  id="modalProcessprdId" class="form-select">
						<option value="" selected>제품명(제품코드)</option>
			    		 <option th:each="item, iterStat : ${prdMstList}" 
							 		th:value="${item.prdId}" 
							 		th:text="${item.prdName} +' (' + ${item.prdId} + ')'"
									name="prdId">
						</option>
					</select>
	            </div>
	            <div class="col-md-4">
	              <label class="form-label">라우트명</label>
	              <input type="text" class="form-control" id="modalRouteName"
	                     placeholder="예: 과일향수 공정 라우트">
	            </div>
	            <div class="col-md-2">
	              <label class="form-label">사용여부</label>
	              <select class="form-select" id="modalRouteUseYn">
	                <option value="Y">활성</option>
	                <option value="N">비활성</option>
	              </select>
	            </div>
	            <div class="col-md-12">
	              <label class="form-label">비고</label>
	              <input type="text" class="form-control" id="modalRouteRemark"
	                     placeholder="예: 숙성 공정 제외, 액체향수 전용 라우트">
	            </div>
				<div id="userAndDate">
					<div class="col-md-3 me-1">
					<label class="form-label">생성자</label>
					<input type="text" class="form-control" id="modalRouteCreatedId" readonly>
					</div>
					<div class="col-md-3 me-1">
					<label class="form-label">생성일시</label>
					<input type="text" class="form-control" id="modalRouteCreatedDate" readonly>
					</div>
					<div class="col-md-3 me-1">
					<label class="form-label">수정자</label>
					<input type="text" class="form-control" id="modalRouteUpdatedId" readonly>
					</div>
					<div class="col-md-3 me-1">
					<label class="form-label">수정일시</label>
					<input type="text" class="form-control" id="modalRouteUpdatedDate" readonly>
					</div>
				</div>
	          </div>
	        </div>
	
	        <!-- 라우트 단계 정의 헤더 (공정코드 조회 버튼 + 단계 추가) -->
			<h6 class="mb-0">공정 단계</h6>
	        <div class="d-flex justify-content-between align-items-center mb-2">
				<p class="text-muted mb-2" style="font-size: 0.75rem;">
					* 라우트단계id는 라우트 id, 공정id을 입력하면 필요데이터가 있을경우 자동생성됩니다.
				</p>
	          <div>
	            <button class="btn btn-outline-secondary btn-sm me-1" type="button" 
	                    onclick="openProcessLookupModal()">
	              공정코드 조회
	            </button>
	            <button class="btn btn-outline-primary btn-sm" type="button"
	                    onclick="addRouteStepRow()">
	              + 단계 추가
	            </button>
				<button id = "deleteRouteStepRowBtn" class="btn btn-outline-primary btn-sm" type="button">
	              - 단계 삭제
	            </button>
	          </div>
	        </div>
	        <div id="processStepGrid" style="display: grid;margin-right:5px;"></div>
	      </div>
	      <div class="modal-footer">
	        <button id="saveRouteBtn" class="btn btn-primary btn-md-sm" type="button">저장</button>
	        <button class="btn btn-secondary btn-md-sm" data-bs-dismiss="modal">닫기</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- 공정코드 조회용 모달 -->
	<div class="modal fade" id="processLookup-modal" tabindex="-1">
	  <div class="modal-dialog modal-lg modal-dialog-scrollable">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">공정코드 조회</h5>
	        <button class="btn-close" data-bs-dismiss="modal"></button>
	      </div>
	      <div class="modal-body small">
	        <p class="text-muted mb-2">
	          라우트 단계에서 사용할 수 있는 공정 코드 목록입니다. (PROCESS_MASTER 기준)
	        </p>
	       	<div id="routeStepCodeGrid" style="display: grid;margin-right:5px;"></div>

	      </div>
	      <div class="modal-footer">
	        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">닫기</button>
	      </div>
	    </div>
	  </div>
	</div>

</th:block>
</body>
<th:block layout:fragment="myScript"> 
		<script th:src="@{/js/masterData/gridCustomRenderers.js}"></script>
		<script th:inline="javascript" th:src="@{/js/masterData/processMst.js}"></script>
</th:block>