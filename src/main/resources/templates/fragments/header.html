<th:block xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:fragment="nav">
	<head>
	<style>
	</style>
	</head>
		<nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar"
          >
            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
            <!-- ğŸ“Œ ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ ë²„íŠ¼ -->
			    <a href="javascript:void(0);" class="nav-link layout-menu-toggle d-xl-none">
			        <i class="bx bx-menu bx-sm"></i>
			    </a>
              <ul class="navbar-nav flex-row align-items-center ms-auto dropdown">
              	<li class="nav-item lh-1 me-3">
              		<span id="badge_payment" style="
				            position: relative;
						    top: -12px;
						    left: 45px;
						    background-color: red;
						    color: rgb(255, 255, 255);
						    border-radius: 15px;
						    padding: 3px 8px;
						    border-color: rgb(255, 255, 255);
						    font-size: 12px;
						    display: none;
				  	"></span>
                    <i class="icon-base bx bx-folder icon" data-bs-toggle="dropdown" id="payment"></i> 
				    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
					  <li><a class="dropdown-item" href="#">Action</a></li>
					  <li><a class="dropdown-item" href="#">Another action</a></li>
					  <li><a class="dropdown-item" href="#">Something else here</a></li>
					  <li><hr class="dropdown-divider"></li>
					  <li><a class="dropdown-item" href="#">Separated link</a></li>
					</ul>
                </li>
              	<li class="nav-item lh-1 me-3"> 
              	<span id="badge_bell" style="
				         position: relative;
						 top: -12px;
						 left: 45px;
						 background-color: red;
						 color: rgb(255, 255, 255);
						 border-radius: 15px;
						 padding: 3px 8px;
						 border-color: rgb(255, 255, 255);
						 font-size: 12px;
						 display: none;
				  "></span>
                   <i class="icon-base bx bx-bell icon" data-bs-toggle="dropdown" id="bell"></i>  
                   <ul class="dropdown-menu">
					  <li><a class="dropdown-item" href="#">bell</a></li>
					  <li><a class="dropdown-item" href="#">ì•Œë¦¼</a></li>
					  <li><a class="dropdown-item" href="#">ê³µì§€ì‚¬í•­</a></li>
					  <li><hr class="dropdown-divider"></li>
					  <li><a class="dropdown-item" href="#">ì§‘ì¤‘</a></li>
					</ul>
                </li>
              	<li class="nav-item lh-1 me-3">
              		<span id="badge_chat" style="
				        position: relative;
						top: -12px;
						left: 45px;
						background-color: blue;
						color: rgb(255, 255, 255);
						border-radius: 15px;
						padding: 3px 8px;
						border-color: rgb(255, 255, 255);
						font-size: 12px;
						display: none;
				  	"></span>
                   <i class="icon-base bx bx-chat icon" data-bs-toggle="dropdown" id="chat"></i>
                   <ul class="dropdown-menu">
					  <li><a class="dropdown-item" href="#">ì ì‹¬ì‹œê°„ì…ë‹ˆë‹¤.</a></li>
					  <li><a class="dropdown-item" href="#">í‡´ê·¼ ì‹œê°„ì…ë‹ˆë‹¤.</a></li>
					  <li><a class="dropdown-item" href="#">ë¬´ìŠ¨ ì»¤í”¼ë“œì‹¤ë˜ìš”</a></li>
					  <li><hr class="dropdown-divider"></li>
					  <li><a class="dropdown-item" href="#">í—¤ì´ì¦ëŸ¿ë¼ë–¼ìš”</a></li>
					</ul>
                </li>
				<!-- ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ í”„ë¡œí•„ ë“œë¡­ë‹¤ìš´ ë³´ì´ê²Œ -->
				<li class="nav-item dropdown lh-1 me-3" sec:authorize="isAuthenticated()">
				  <a class="nav-link dropdown-toggle nav-font-size d-flex align-items-center"
				     href="#"
				     id="userDropdown"
				     role="button"
				     data-bs-toggle="dropdown"
				     aria-expanded="false">
				    <span class="me-1" sec:authentication="principal.empName"></span>
				    (<span sec:authentication="principal.empId"></span>)
				  </a>
				
				 <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
				  <!-- ë‚´ ì •ë³´ ëª¨ë‹¬ -->
				  <li><a class="dropdown-item" href="#" id="btnMyInfo">ë‚´ ì •ë³´</a></li>
				
				  <!-- ë‚´ ì •ë³´ ìˆ˜ì •: ì—¬ê¸°ì„œ ë°”ë¡œ í˜ì´ì§€ë¡œ ì´ë™ -->
				  <li><a class="dropdown-item" th:href="@{/my/info/edit}">ê°œì¸ì •ë³´ ìˆ˜ì •</a></li>
				
				  <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
				  <li><a class="dropdown-item" th:href="@{/my/password}">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a></li>
				  <li><hr class="dropdown-divider"></li>
				
				  <!-- ë¡œê·¸ì•„ì›ƒ -->
				  <li>
				    <a class="dropdown-item logout-link" href="#">
				      ë¡œê·¸ì•„ì›ƒ
				    </a>
				  </li>
				</ul>
				</li>
				<!-- ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš°ì—ëŠ” ê·¸ëƒ¥ login ë§í¬ë§Œ -->
				<li class="nav-item lh-1 me-3" sec:authorize="!isAuthenticated()">
				  <a class="nav-font-size" id="login-link" th:href="@{/login}">login</a>
				</li>


              </ul>
            </div>
          </nav>
		
		<form th:action="@{/logout}" method="post" id="hiddenLogoutForm" style="display:none">
		  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
		</form>
		
		<script>
		  document.querySelectorAll('.logout-link').forEach(link => {
		    link.addEventListener('click', function (e) {
		      e.preventDefault();
		      if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
		        document.getElementById('hiddenLogoutForm').submit();
		      }
		    });
		  });
		</script>
	
		<script>
		  // ================== ë‚´ ì •ë³´ ëª¨ë‹¬ ì—´ê¸° ==================
		  document.getElementById('btnMyInfo')?.addEventListener('click', function (e) {
		    e.preventDefault();
		
		    fetch('/my/info')
		      .then(res => {
		        if (!res.ok) {
		          throw new Error('HTTP ' + res.status);
		        }
		        return res.json();
		      })
		      .then(data => {
		
		        const titleEl = document.getElementById('empDetailModalTitle');
		        const modalEl = document.getElementById('empDetailModal');
		        const editBtn = document.getElementById('editBtn');
		
		        // ëª¨ë‹¬ ìš”ì†Œ ì—†ìœ¼ë©´ ê²½ê³  í›„ ì¤‘ë‹¨
		        if (!modalEl || !titleEl) {
		          alert('ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë ˆì´ì•„ì›ƒ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
		          return;
		        }
		
		        // ì œëª©
		        titleEl.innerText = 'ë‚´ ì •ë³´';
		
		        // ìˆ˜ì • ë²„íŠ¼ ìˆ¨ê¸°ê¸°
		        if (editBtn) {
		          editBtn.style.display = 'none';
		        }
		
		        // ëª¨ë“  í•„ë“œ ì„¸íŒ… (í•„ë“œ ì¡´ì¬í•  ë•Œë§Œ)
		        const fields = {
		          empName: document.getElementById('d-empName'),
		          empId: document.getElementById('d-empId'),
		          deptName: document.getElementById('d-deptName'),
		          posName: document.getElementById('d-posName'),
		          gender: document.getElementById('d-gender'),
		          hireDate: document.getElementById('d-hireDate'),
		          mobile: document.getElementById('d-mobile'),
		          email: document.getElementById('d-email'),
		          address: document.getElementById('d-address'),
		          rrn: document.getElementById('d-rrn'),
		          bank: document.getElementById('d-bank'),
		        };
		
		        if (fields.empName)  fields.empName.innerText  = data.empName  ?? '';
		        if (fields.empId)    fields.empId.innerText    = data.empId    ?? '';
		        if (fields.deptName) fields.deptName.innerText = data.deptName ?? '';
		        if (fields.posName)  fields.posName.innerText  = data.posName  ?? '';
		        if (fields.gender)   fields.gender.innerText   = data.gender   ?? '';
		        if (fields.hireDate) fields.hireDate.innerText = data.hireDate ?? '';
		        if (fields.mobile)   fields.mobile.innerText   = data.mobile   ?? '';
		        if (fields.email)    fields.email.innerText    = data.email    ?? '';
		        if (fields.address)  fields.address.innerText  = data.address  ?? '';
		        if (fields.rrn)      fields.rrn.innerText      = data.rrnMasked ?? '';
		        if (fields.bank)     fields.bank.innerText     = data.bankInfo ?? '';
		
		        // ëª¨ë‹¬ í‘œì‹œ
		        const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
		        modal.show();
		      })
		      .catch(() => {
		        alert("ë‚´ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
		      });
		  });
		
		  // ================== ì •ë³´ ìˆ˜ì • ë²„íŠ¼ ==================
		  document.getElementById('editBtn')?.addEventListener('click', function () {
		    if (window.detailMode === 'self') {
		      window.location.href = '/my/info/edit';
		    }
		  });
		</script>
		<script src="/js/emp/emp.js"></script>


		  <script>
			//Resources
		  
         	const payment = document.getElementById("payment");
      		const bell = document.getElementById("bell");
      		const chat = document.getElementById("chat");

        	const badgePayment = document.getElementById("badge_payment");
        	const badgeBell = document.getElementById("badge_bell");
        	const badgeChat = document.getElementById("badge_chat");
            this.pamentCount = 0;
            this.bellCount = 0;
            this.chatCount = 0;

    		payment.addEventListener("click",()=>{
    			
    		    if(badgePayment.style.display === 'none'){
    		    	this.pamentCount += 1;
    		    	badgePayment.textContent = this.pamentCount;
    		    	badgePayment.style.display = 'unset';
    		    }else {
    		    	badgePayment.style.display = 'none';
    		    }
    		});

    		
    		bell.addEventListener("click",()=>{
    			if(badgeBell.style.display === 'none'){
       		    	this.bellCount += 1;
       		    	badgeBell.textContent = this.bellCount;
       		    	badgeBell.style.display = 'block';
       		    }else {
       		    	badgeBell.style.display = 'none';
       		    }
      		});
    		
    		chat.addEventListener("click",()=>{
    	    	 window.open(
    			    "/messenger/list",
    			    "messenger",
    			    "noopener,noreferrer,width=500,height=700,left=200,top=100,resizable=no"
    			 );
            	/*const iframe = document.createElement("iframe");
    			iframe.src = "/messenger/popup";
    			iframe.style.position = "fixed";
    			iframe.style.right = "20px";
    			iframe.style.bottom = "20px";
    			iframe.style.width = "400px";
    			iframe.style.height = "600px";
    			iframe.style.border = "1px solid #ccc";
    			iframe.style.boxShadow = "0 0 12px rgba(0,0,0,0.2)";
    			iframe.style.borderRadius = "12px";
    			iframe.style.zIndex = "9999";
    			document.body.appendChild(iframe);*/
    			
    			/*if(badgeChat.style.display === 'none')  {
          		   	this.chatCount += 1;
          		   	badgeChat.textContent = this.chatCount;
          		   	badgeChat.style.display = 'block';
          		}else {
          			badgeChat.style.display = 'none';
          		}*/
      		});
    		
    		window.addEventListener("message", (event) => {
   			  if (event.data === "closeMessengerFrame") {
   			    document.querySelector("iframe[src='/messenger/popup']")?.remove();
   			  }
   			});
          </script>
          
		<script>
		 
		</script>


          
</th:block>