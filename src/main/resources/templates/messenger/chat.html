<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Messenger Chat</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/msg/chat.css}"/>
</head>

<body class="d-flex align-items-center justify-content-center vh-100">

  <div class="chat-window">
    <div class="chat-header">
      <h6 id="friend-name">ëŒ€í™”ë°©</h6>
    </div>

    <div class="chat-body" id="chat-body">
      <div class="msg-left">
        ì•ˆë…• ğŸ‘‹  
        <div class="msg-time">ì˜¤ì „ 10:12</div>
      </div>
      <div class="msg-right">
        í•˜ì´~ ì˜ ì§€ëƒˆì–´?  
        <div class="msg-time"><span>ì˜¤ì „ 10:13</span> <i class="bi bi-check2"></i></div>
      </div>
    </div>

    <div class="chat-footer">
      <div class="input-row">
        <textarea id="message" rows="1" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        <button id="emoji"><i class="bi bi-emoji-smile"></i></button>
        <button id="send"><i class="bi bi-send-fill"></i></button>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const friend = params.get('friend');
    const nameElement = document.getElementById('friend-name');
    if (friend) nameElement.textContent = friend;

    const chatBody = document.getElementById('chat-body');
    const textarea = document.getElementById('message');
    const sendBtn = document.getElementById('send');

    // ìë™ ë†’ì´ ì¡°ì ˆ
    textarea.addEventListener('input', () => {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 130) + 'px';
    });

    // ì‹œê°„ í¬ë§· í•¨ìˆ˜
    function formatTime() {
      const now = new Date();
      const h = now.getHours();
      const m = now.getMinutes().toString().padStart(2, '0');
      const ampm = h < 12 ? 'ì˜¤ì „' : 'ì˜¤í›„';
      const hour12 = h % 12 || 12;
      return `${ampm} ${hour12}:${m}`;
    }

    // ë©”ì‹œì§€ ì „ì†¡ ê¸°ëŠ¥
    sendBtn.addEventListener('click', sendMessage);
    textarea.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    function sendMessage() {
      const msg = textarea.value.trim();
      if (!msg) return;

      const wrapper = document.createElement('div');
      wrapper.classList.add('msg-right');
      wrapper.innerHTML = `${msg}<div class="msg-time"><span>${formatTime()}</span> <i class="bi bi-check2"></i></div>`;
      chatBody.appendChild(wrapper);

      textarea.value = '';
      textarea.style.height = '40px';

      chatBody.scrollTop = chatBody.scrollHeight;

      // ì½ìŒ í‘œì‹œ (2ì´ˆ ë’¤)
      setTimeout(() => {
        const icon = wrapper.querySelector('.bi-check2');
        icon.classList.remove('bi-check2');
        icon.classList.add('bi-check2-all');
        icon.style.color = '#00e1ff';
      }, 2000);
    }
  </script>

</body>
</html>
