<th:block xmlns:th="http://www.thymeleaf.org"
          xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
          layout:decorate="~{/layouts/layout.html}">

  <!-- 하나의 fragment 안에 전부 포함 -->
  <th:block layout:fragment="content">
    <!-- CSS -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />

    <div class="custom-body container-xxl flex-grow-1 container-p-y">
      <h2>사원 목록</h2>

      <!-- 검색 바 -->
      <div class="row align-items-center g-2 mb-3">
        <div class="col-12 col-lg-9">
          <form class="row g-2 align-items-center" onsubmit="return false" role="search">
            <div class="col-12 col-md-auto">
              <input class="form-control" id="kw" type="search"
                     placeholder="사번 / 성명 / 부서 / 직급 / 이메일 검색" style="width:280px;">
            </div>
            <div class="col-6 col-md-auto">
              <select class="form-select" id="deptId">
                <option value="">부서 전체</option>
                <option>개발부</option>
                <option>마케팅부</option>
                <option>생산부</option>
                <option>영업부</option>
                <option>인사부</option>
              </select>
            </div>
            <div class="col-6 col-md-auto d-grid">
              <button class="btn btn-outline-primary" id="btnSearch" type="button">Search</button>
            </div>
          </form>
        </div>
        <div class="col-12 col-lg-3 d-grid d-lg-flex justify-content-lg-end">
          <a href="/emp/regist" class="btn btn-primary">인사 등록</a>
        </div>
      </div>

      <!-- 그리드 DOM 반드시 포함 -->
      <div id="grid" style="height:600px;"></div>
    </div>

    <!-- JS -->
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
    <script>
	  // 1️. DOM이 모두 준비되면 실행
	  document.addEventListener('DOMContentLoaded', initPage);
	
	  // ======================================
	  // 2️. 페이지 초기화 함수
	  function initPage() {
	    // 데이터 먼저 로드하고, 로딩 성공 시 그리드 세팅
	    fetch('/emp/list/data')
	      .then(response => response.json())
	      .then(data => initToastGrid(data)) // <- 아래 함수 호출
	      .catch(() => alert('사원 목록 요청 실패!'));
	  }
	
	  // ======================================
	  // 3️. Toast Grid 생성 함수
	  function initToastGrid(data) {
	    const grid = new tui.Grid({
	      el: document.getElementById('grid'), // grid가 들어갈 div
	      bodyHeight: 540,                     // 표 높이
	      rowHeaders: [],                      // 왼쪽 번호/체크박스 없음
	      scrollX: true,                       // 가로 스크롤
	      scrollY: true,                       // 세로 스크롤
	      editable: false,                     // 읽기 전용
	      columns: [
	        { header: '입사일자', name: 'hireDate', align: 'center' },
	        { header: '사번',     name: 'empId',    align: 'center' },
	        { header: '성명',     name: 'empName',  align: 'center' },
	        { header: '부서',     name: 'deptName', align: 'center' },
	        { header: '직급',     name: 'posName',  align: 'center' },
	        { header: '전화번호', name: 'mobile',   align: 'center' },
	        { header: 'Email',    name: 'email',    width: 220 },
	        {
	          header: ' ',
	          name: 'btn',
	          width: 110,
	          align: 'center',
	          formatter: () => "<button type='button' class='btn btn-info btn-sm'>상세정보</button>"
	        }
	      ]
	    });
	
	    // JSON 데이터 삽입
	    grid.resetData(data);
	
	    // 버튼 클릭 이벤트
	    grid.on('click', (ev) => {
	      if (ev.columnName !== 'btn') return;
	      const row = grid.getRow(ev.rowKey);
	      if (row?.empId) location.href = '/emp/detail/' + row.empId;
	    });
	  }
	</script>

  </th:block>
</th:block>