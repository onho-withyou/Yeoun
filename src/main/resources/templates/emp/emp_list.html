<th:block xmlns:th="http://www.thymeleaf.org"
          xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
          layout:decorate="~{/layouts/layout.html}">
<body>
<th:block layout:fragment="content">
    <div class="custom-body container-xxl flex-grow-1 container-p-y">
    
    <h2>사원 목록</h2>

      <!-- 검색 바 -->
      <div class="row align-items-center g-2 mb-3">
        <div class="col-12 col-lg-9">
        
          <form class="row g-2 align-items-center" th:action="@{/emp}" method="get" role="search">
          
          	<!-- 부서 셀렉트 -->
            <div class="col-6 col-md-auto">
              <select class="form-select" id="deptId" name="deptId">
                <option value="">부서 전체</option>
                <option th:each="d : ${deptList}" th:value="${d.deptId}" th:text="${d.deptName}"
                        th:selected="${deptId} != null and ${deptId} == ${d.deptId}"
                        th:if="${d.parentDeptId != null}">
                </option>
              </select>
            </div>
            
            <!-- 키워드 -->
            <div class="col-12 col-md-auto">
              <input class="form-control" id="keyword" name="keyword" type="search"
                     placeholder="사번 / 성명 / 부서 / 직급 / 이메일 검색" style="width:280px;" th:value="${keyword}">
            </div>
            
            <div class="col-6 col-md-auto d-grid">
              <button class="btn btn-outline-primary" id="btnSearch" type="button">검색</button>
            </div>
          </form>
        </div>
        <div class="col-12 col-lg-3 d-grid d-lg-flex justify-content-lg-end">
          <a href="/emp/regist" class="btn btn-primary">인사 등록</a>
        </div>
      </div>
      
      <!-- 사원 상세 정보 모달 -->
		<div class="modal fade" id="empDetailModal" tabindex="-1" aria-hidden="true">
		  <!-- modal-xl : 더 넓은 폭 / centered : 수직 중앙 -->
		  <div class="modal-dialog modal-dialog-centered emp-detail-modal">
		  <div class="modal-content">
		    <div class="modal-header">
		      <h5 class="modal-title fw-bold">사원 상세</h5>
		      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
		    </div>
		
		    <div class="modal-body">
		      <div class="container-fluid">
		        <div class="row g-4">
		          
				<!-- 왼쪽: 핵심 정보 -->
				<div class="col-lg-12">
				  <!-- 섹션: 기본 정보 -->
				  <div class="mb-3">
				    <div class="d-flex align-items-center mb-2">
				      <span class="fw-semibold me-2">기본 정보</span>
				      <div class="flex-grow-1 border-top"></div>
				    </div>
				
				    <!-- 사진 + 텍스트 묶음 -->
				    <div class="d-flex align-items-start gap-4">
				      <!-- 프로필 사진 -->
				      <div class="flex-shrink-0">
				        <img id="d-photo"
				             src="/img/default-profile.png"
				             alt="프로필 사진"
				             class="rounded"
				             style="width: 120px; height: 120px; object-fit: cover;">
				      </div>
				
				      <!-- 기본 정보 텍스트 -->
				      <div class="flex-grow-1">
				        <div class="row gy-2 gx-3">
				          <div class="col-md-6">
				            <div class="text-secondary small">이름</div>
				            <div id="d-empName" class="fw-semibold fs-6">—</div>
				          </div>
				          <div class="col-md-6">
				            <div class="text-secondary small">사번</div>
				            <div id="d-empId" class="fw-semibold fs-6">—</div>
				          </div>
				          <div class="col-md-6">
				            <div class="text-secondary small">부서</div>
				            <div id="d-deptName">—</div>
				          </div>
				          <div class="col-md-6">
				            <div class="text-secondary small">직급</div>
				            <div id="d-posName">—</div>
				          </div>
				          <div class="col-md-6">
				            <div class="text-secondary small">성별</div>
				            <div id="d-gender">—</div>
				          </div>
				          <div class="col-md-6">
				            <div class="text-secondary small">입사일</div>
				            <div id="d-hireDate">—</div>
				          </div>
				        </div>
				      </div>
				    </div>
				    <!-- /사진 + 텍스트 묶음 -->
				  </div>
				
				  <!-- 섹션: 연락/계정 -->
				  <div class="mb-3">
				    <div class="d-flex align-items-center mb-2">
				      <span class="fw-semibold me-2">연락/계정</span>
				      <div class="flex-grow-1 border-top"></div>
				    </div>
				    <div class="row gy-2 gx-3">
				      <div class="col-md-6">
				        <div class="text-secondary small">연락처</div>
				        <div id="d-mobile">—</div>
				      </div>
				      <div class="col-md-6">
				        <div class="text-secondary small">이메일</div>
				        <div id="d-email">—</div>
				      </div>
				      <div class="col-12">
				        <div class="text-secondary small">주소</div>
				        <div id="d-address">—</div>
				      </div>
				    </div>
				  </div>
				
				  <!-- 섹션: 민감정보(마스킹) -->
				  <div class="mb-1">
				    <div class="d-flex align-items-center mb-2">
				      <span class="fw-semibold me-2">민감 정보</span>
				      <div class="flex-grow-1 border-top"></div>
				    </div>
				    <div class="row gy-2 gx-3">
				      <div class="col-md-6">
				        <div class="text-secondary small">주민등록번호</div>
				        <div id="d-rrn" class="text-body">—</div>
				      </div>
				      <div class="col-md-6">
				        <div class="text-secondary small">급여통장</div>
				        <div id="d-bank" class="text-body" style="white-space: pre-line;">—</div>
				      </div>
				    </div>
				    <div class="text-muted small mt-2">
				      ※ 주민등록번호/계좌는 마스킹 상태로만 노출됩니다.
				    </div>
				  </div>
				</div>

		
		        </div><!-- /row -->
		      </div><!-- /container-fluid -->
		    </div>
		
		    <div class="modal-footer">
		      <button type="button" class="btn btn-primary" id="editBtn" >수정</button>
		      <button class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
		    </div>
		    
		  </div>
		</div>
	  </div>
	  
	  <br>

      <!-- 그리드 DOM 반드시 포함 -->
      <div class="card-body p-0">
	    <div id="grid"></div>
      </div>
      
      <br>
      
      <nav aria-label="사원 목록 페이지네이션">
		<ul class="pagination justify-content-center" id="empPagination"></ul>
      </nav>
      
    </div>

<!-- 초기 데이터 JS로 넘기기 -->
<script th:inline="javascript">
  const initialEmpList = /*[[${empList}]]*/ [];
</script>    

<script src="/js/emp/empList.js"></script>

</th:block>
</body>