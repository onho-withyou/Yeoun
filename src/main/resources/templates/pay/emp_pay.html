<th:block xmlns:th="http://www.thymeleaf.org"
          xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
          layout:decorate="~{layouts/layout}"> <!-- ê²½ë¡œ ìˆ˜ì •: /ì™€ .html ì œê±° -->

  <th:block layout:fragment="content">

   <div class="container-xxl py-4">

      <!-- ===================== PAGE HEADER ===================== -->
      <header>
        <div class="container row" style="align-items:center; justify-content:space-between; gap:12px;">
          <div class="grow">
            <h1 style="margin:0">ê¸‰ì—¬ ëª…ì„¸ì„œ ì¡°íšŒ</h1>
            <div class="subtitle">ì›”ë³„ ê¸‰ì—¬ëª…ì„¸ì„œ í™•ì¸ Â· PDF ë‹¤ìš´ë¡œë“œ Â· ë¬¸ì˜ ë“±ë¡</div>
          </div>
          <div class="toolbar" style="display:flex; gap:8px; align-items:center">
            <button class="btn btn-outline-secondary btn-sm" id="prevMonthBtn">â—€ ì´ì „</button>
            <input id="month" type="month" class="form-control form-control-sm" style="width:150px">
            <button class="btn btn-outline-secondary btn-sm" id="nextMonthBtn">ë‹¤ìŒ â–¶</button>
            <button class="btn btn-outline-primary btn-sm" id="printBtn">ğŸ–¨ PDF ì €ì¥</button>
            <button class="btn btn-outline-primary btn-sm" id="openCompareBtn">ğŸ“Š ì „ì›”/ì „ë…„ë„ ë¹„êµ</button>
          </div>
        </div>
      </header>

      <main class="container grid" style="margin-top:16px">
        <!-- Summary -->
        <section class="grid two" style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
          <div class="panel" style="border:1px solid #e5e7eb; border-radius:8px; padding:16px">
            <div class="muted mini" id="payMonthLabel">2025-01</div>
            <div class="kpi" id="netPay" style="font-size:28px; font-weight:700">â‚©0</div>
            <div class="kpi-sub" style="color:#64748b">ì‹¤ìˆ˜ë ¹ì•¡</div>
          </div>
          <div class="panel" style="border:1px solid #e5e7eb; border-radius:8px; padding:16px">
            <div class="row" style="display:flex; justify-content:space-between; gap:12px">
              <div>
                <div><strong id="empName">í™ê¸¸ë™</strong> <span class="badge bg-secondary" id="empPos">ëŒ€ë¦¬</span></div>
                <div class="muted mini">ë¶€ì„œ: <span id="empDept">ê°œë°œ1íŒ€</span> Â· ì‚¬ë²ˆ: <span id="empNo">E2025001</span></div>
              </div>
              <div class="right" style="text-align:right">
                <div>ì§€ê¸‰ì¼: <span id="payDate">2025-01-25</span></div>
                <div class="muted mini">ì§€ê¸‰ì€í–‰: <span id="bank">êµ­ë¯¼(**-**-1234)</span></div>
              </div>
            </div>
            <div class="muted mini" id="memo" style="margin-top:8px">íŠ¹ì´ì‚¬í•­ ì—†ìŒ.</div>
          </div>
        </section>

        <!-- Tables -->
        <section class="grid two" style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px">
          <div class="card" style="border:1px solid #e5e7eb; border-radius:8px; padding:16px">
            <div class="row" style="display:flex; justify-content:space-between; align-items:center">
              <h3 style="margin:0; font-size:16px">ì§€ê¸‰ í•­ëª©</h3>
              <span class="muted mini" id="earnCount">0ê°œ</span>
            </div>
            <div class="table-responsive" style="margin-top:8px">
              <table id="earnTable" class="table table-sm">
                <thead><tr><th>í•­ëª©</th><th class="text-end">ê¸ˆì•¡</th><th class="text-end">ë¹„ê³ </th></tr></thead>
                <tbody></tbody>
                <tfoot><tr><th>ì†Œê³„</th><th class="text-end" id="earnTotal">â‚©0</th><th></th></tr></tfoot>
              </table>
            </div>
          </div>

          <div class="card" style="border:1px solid #e5e7eb; border-radius:8px; padding:16px">
            <div class="row" style="display:flex; justify-content:space-between; align-items:center">
              <h3 style="margin:0; font-size:16px">ê³µì œ í•­ëª©</h3>
              <span class="muted mini" id="dedCount">0ê°œ</span>
            </div>
            <div class="table-responsive" style="margin-top:8px">
              <table id="deductTable" class="table table-sm">
                <thead><tr><th>í•­ëª©</th><th class="text-end">ê¸ˆì•¡</th><th class="text-end">ë¹„ê³ </th></tr></thead>
                <tbody></tbody>
                <tfoot><tr><th>ì†Œê³„</th><th class="text-end" id="deductTotal">â‚©0</th><th></th></tr></tfoot>
              </table>
            </div>
          </div>
        </section>

        
      </main>

      <script>
        // ì•ˆì „ í—¬í¼
        const el = id => document.getElementById(id);
        const fmt = n => "â‚©" + (n || 0).toLocaleString("ko-KR");

        // ë°ëª¨ ë°ì´í„°
        const SAMPLE = {
          employee: { name:"í™ê¸¸ë™", dept:"ê°œë°œ1íŒ€", pos:"ëŒ€ë¦¬", no:"E2025001", bank:"êµ­ë¯¼(**-**-1234)" },
          months: {
            "2025-01": {
              payDate:"2025-01-25",
              memo:"ì—°ë§ì •ì‚° ì •ì‚°ë¶„ ì¼ë¶€ ì°¨ì›” ë°˜ì˜.",
              earn:[
                {name:"ê¸°ë³¸ê¸‰", amount:2800000, note:""},
                {name:"ì‹ëŒ€", amount:200000, note:"ë¹„ê³¼ì„¸"},
                {name:"êµí†µë¹„", amount:100000, note:""},
                {name:"ì•¼ê·¼ìˆ˜ë‹¹", amount:240000, note:"15ì‹œê°„"}
              ],
              deduct:[
                {name:"ì†Œë“ì„¸", amount:120000, note:""},
                {name:"ì§€ë°©ì†Œë“ì„¸", amount:12000, note:""},
                {name:"êµ­ë¯¼ì—°ê¸ˆ", amount:126000, note:"4.5%"},
                {name:"ê±´ê°•ë³´í—˜", amount:103000, note:""},
                {name:"ê³ ìš©ë³´í—˜", amount:23000, note:""}
              ]
            },
            "2024-12": {
              payDate:"2024-12-25",
              memo:"ì„±ê³¼ê¸‰ ë³„ë„ì§€ê¸‰(ë¹„ì •ê¸°).",
              earn:[
                {name:"ê¸°ë³¸ê¸‰", amount:2800000, note:""},
                {name:"ì‹ëŒ€", amount:200000, note:"ë¹„ê³¼ì„¸"},
                {name:"ì„±ê³¼ê¸‰", amount:1000000, note:"ë¹„ì •ê¸°"}
              ],
              deduct:[
                {name:"ì†Œë“ì„¸", amount:210000, note:""},
                {name:"ì§€ë°©ì†Œë“ì„¸", amount:21000, note:""},
                {name:"êµ­ë¯¼ì—°ê¸ˆ", amount:126000, note:""},
                {name:"ê±´ê°•ë³´í—˜", amount:103000, note:""},
                {name:"ê³ ìš©ë³´í—˜", amount:23000, note:""}
              ]
            }
          }
        };

        function loadMonth(month){
          const m = SAMPLE.months[month];
          const emp = SAMPLE.employee;
          if(!m){ alert("í•´ë‹¹ ì›” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

          el('payMonthLabel').textContent = month;
          el('payDate').textContent = m.payDate;
          el('bank').textContent = emp.bank;
          el('empName').textContent = emp.name;
          el('empDept').textContent = emp.dept;
          el('empPos').textContent = emp.pos;
          el('empNo').textContent = emp.no;
          if (el('memo')) el('memo').textContent = m.memo || "íŠ¹ì´ì‚¬í•­ ì—†ìŒ.";

          const earnBody = el('earnTable').querySelector('tbody');
          const dedBody  = el('deductTable').querySelector('tbody');
          earnBody.innerHTML = ""; dedBody.innerHTML = "";

          let earnTotal=0, dedTotal=0;
          m.earn.forEach(it => {
            earnTotal += it.amount;
            earnBody.insertAdjacentHTML('beforeend',
              `<tr><td>${it.name}</td><td class="text-end">${fmt(it.amount)}</td><td class="text-end text-muted">${it.note||""}</td></tr>`);
          });
          m.deduct.forEach(it => {
            dedTotal += it.amount;
            dedBody.insertAdjacentHTML('beforeend',
              `<tr><td>${it.name}</td><td class="text-end">${fmt(it.amount)}</td><td class="text-end text-muted">${it.note||""}</td></tr>`);
          });

          el('earnTotal').textContent = fmt(earnTotal);
          el('deductTotal').textContent = fmt(dedTotal);
          el('netPay').textContent = fmt(earnTotal - dedTotal);
          el('earnCount').textContent = m.earn.length + "ê°œ";
          el('dedCount').textContent = m.deduct.length + "ê°œ";
          el('month').value = month;
        }

        function shiftMonth(current, diff){
          if(!current){ // ì´ˆê¸°ê°’ ì—†ìœ¼ë©´ ì˜¤ëŠ˜ ê¸°ì¤€
            const today = new Date();
            const y = today.getFullYear();
            const m = String(today.getMonth()+1).padStart(2,'0');
            current = `${y}-${m}`;
          }
          const [y,m] = current.split('-').map(Number);
          const d = new Date(y, m-1+diff, 1);
          const yyyy = d.getFullYear();
          const mm = String(d.getMonth()+1).padStart(2,'0');
          return `${yyyy}-${mm}`;
        }

       
        document.addEventListener('DOMContentLoaded', () => {
          // ì´ˆê¸° ì›”: ìƒ˜í”Œì—ì„œ ê°€ì¥ ìµœì‹ 
          const keys = Object.keys(SAMPLE.months).sort().reverse();
          loadMonth(keys[0]);
          renderInquiries();

          // í”„ë¦°íŠ¸
          const printBtn = el('printBtn');
          if (printBtn) printBtn.addEventListener('click', ()=> window.print());

          // ì›” ì´ë™
          const monthInput = el('month');
          if (monthInput && !monthInput.value) {
            // ë¸Œë¼ìš°ì € ê¸°ë³¸ ì›” í¬ë§· ì„¸íŒ…
            const d = new Date(keys[0]+'-01');
            const v = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
            monthInput.value = v;
          }
          const prev = el('prevMonthBtn'), next = el('nextMonthBtn');
          if (prev) prev.addEventListener('click', ()=> loadMonth(shiftMonth(el('month').value, -1)));
          if (next) next.addEventListener('click', ()=> loadMonth(shiftMonth(el('month').value, +1)));
          if (monthInput) monthInput.addEventListener('change', e => loadMonth(e.target.value));
        });
      </script>

    </div>

  </th:block>
</th:block>
