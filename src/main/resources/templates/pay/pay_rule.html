<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>급여 기준 정보 (PAY_RULE)</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        body{background:#f6f7fb}
        .card{border-radius:14px}
        .form-text{font-size:12px}
        .table thead th{white-space:nowrap}
        .nowrap{white-space:nowrap}
        .small{font-size:.9rem}
    </style>
</head>
<body>
<div class="container py-4">
    <h2 class="fw-bold text-primary mb-3">급여 기준 정보 (PAY_RULE)</h2>

    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title mb-3">기준 등록</h5>
            <form th:action="@{/pay/rule}" th:object="${newRule}" method="post" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">적용 시작일 (START_DATE)</label>
                    <input type="date" th:field="*{startDate}" class="form-control" required>
                    <div class="form-text">해당 기준의 적용 시작일</div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">적용 종료일 (END_DATE)</label>
                    <input type="date" th:field="*{endDate}" class="form-control">
                    <div class="form-text">무기한이면 비워두세요</div>
                </div>

                <div class="col-md-3">
                    <label class="form-label">기본급 (BASE_AMT)</label>
                    <input type="number" th:field="*{baseAmt}" class="form-control" step="0.01" min="0" placeholder="예: 2500000">
                </div>
                <div class="col-md-3">
                    <label class="form-label">식대 (MEAL_AMT)</label>
                    <input type="number" th:field="*{mealAmt}" class="form-control" step="0.01" min="0" placeholder="예: 200000">
                </div>

                <div class="col-md-3">
                    <label class="form-label">교통비 (TRANS_AMT)</label>
                    <input type="number" th:field="*{transAmt}" class="form-control" step="0.01" min="0" placeholder="예: 100000">
                </div>

                <div class="col-md-3">
                    <label class="form-label">국민연금율 (PEN_RATE)</label>
                    <input type="number" th:field="*{penRate}" class="form-control" step="0.0001" min="0" max="1" placeholder="예: 0.045">
                    <div class="form-text">예) 4.5% → 0.045</div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">건강보험율 (HLTH_RATE)</label>
                    <input type="number" th:field="*{hlthRate}" class="form-control" step="0.0001" min="0" max="1" placeholder="예: 0.035">
                </div>
                <div class="col-md-3">
                    <label class="form-label">고용보험율 (EMP_RATE)</label>
                    <input type="number" th:field="*{empRate}" class="form-control" step="0.0001" min="0" max="1" placeholder="예: 0.009">
                </div>

                <div class="col-md-3">
                    <label class="form-label">소득세율 (TAX_RATE)</label>
                    <input type="number" th:field="*{taxRate}" class="form-control" step="0.0001" min="0" max="1" placeholder="예: 0.05">
                    <div class="form-text">예) 5% → 0.05</div>
                </div>

                <div class="col-md-3">
                    <label class="form-label">지급일 (PAY_DAY)</label>
                    <input type="number" th:field="*{payDay}" class="form-control" min="1" max="31" placeholder="예: 25" required>
                    <div class="form-text">매월 n일 지급</div>
                </div>

                <div class="col-md-3">
                    <label class="form-label">상태 (STATUS)</label>
                    <select th:field="*{status}" class="form-select">
                        <option value="ACTIVE">ACTIVE</option>
                        <option value="INACTIVE">INACTIVE</option>
                    </select>
                    <div class="form-text">현재 기준 사용 여부</div>
                </div>

                <div class="col-12">
                    <label class="form-label">비고 (REMARK)</label>
                    <textarea th:field="*{remark}" class="form-control" rows="2" placeholder="메모..."></textarea>
                </div>

                <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-primary">등록</button>
                    <button type="reset" class="btn btn-outline-secondary">초기화</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title mb-3">기준 목록</h5>
            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle bg-white">
                    <thead class="table-light">
                    <tr class="text-center">
                        <th class="nowrap">RULE_ID</th>
                        <th class="nowrap">START_DATE</th>
                        <th class="nowrap">END_DATE</th>
                        <th class="nowrap">BASE_AMT</th>
                        <th class="nowrap">MEAL_AMT</th>
                        <th class="nowrap">TRANS_AMT</th>
                        <th class="nowrap">PEN_RATE</th>
                        <th class="nowrap">HLTH_RATE</th>
                        <th class="nowrap">EMP_RATE</th>
                        <th class="nowrap">TAX_RATE</th>
                        <th class="nowrap">PAY_DAY</th>
                        <th class="nowrap">STATUS</th>
                        <th class="nowrap">REMARK</th>
                        <th class="nowrap">CREATED_DATE</th>
                        <th class="nowrap">UPDATED_DATE</th>
                        <th class="nowrap">관리</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="r : ${rules}">
                        <td th:text="${r.ruleId}" class="text-center"></td>
                        <td th:text="${#temporals.format(r.startDate, 'yyyy-MM-dd')}" class="text-center"></td>
                        <td th:text="${r.endDate != null ? #temporals.format(r.endDate, 'yyyy-MM-dd') : ''}" class="text-center"></td>
                        <td th:text="${#numbers.formatDecimal(r.baseAmt, 0, 'COMMA', 2, 'POINT')}"></td>
                        <td th:text="${#numbers.formatDecimal(r.mealAmt, 0, 'COMMA', 2, 'POINT')}"></td>
                        <td th:text="${#numbers.formatDecimal(r.transAmt, 0, 'COMMA', 2, 'POINT')}"></td>
                        <td th:text="${r.penRate}"></td>
                        <td th:text="${r.hlthRate}"></td>
                        <td th:text="${r.empRate}"></td>
                        <td th:text="${r.taxRate}"></td>
                        <td th:text="${r.payDay}" class="text-center"></td>
                        <td>
                            <span th:text="${r.status}" th:classappend="${r.status.name()=='ACTIVE'} ? 'badge bg-success' : 'badge bg-secondary'"></span>
                        </td>
                        <td th:text="${r.remark}"></td>
                        <td th:text="${#temporals.format(r.createdDate, 'yyyy-MM-dd HH:mm')}"></td>
                        <td th:text="${r.updatedDate != null ? #temporals.format(r.updatedDate, 'yyyy-MM-dd HH:mm') : ''}"></td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-outline-primary"
                                    data-bs-toggle="modal"
                                    th:attr="data-bs-target=${'#editModal-' + r.ruleId}">
                                수정
                            </button>
                            <a th:href="@{'/pay/rule/delete/' + ${r.ruleId}}"
                               class="btn btn-sm btn-outline-danger"
                               onclick="return confirm('삭제하시겠습니까?');">삭제</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div th:each="r : ${rules}">
        <div class="modal fade" th:id="${'editModal-' + r.ruleId}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <form th:action="@{'/pay/rule/' + ${r.ruleId}}" method="post">
                        <div class="modal-header">
                            <h5 class="modal-title">기준 수정 - <span th:text="${r.ruleId}"></span></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">START_DATE</label>
                                    <input type="date" name="startDate" th:value="${#temporals.format(r.startDate, 'yyyy-MM-dd')}" class="form-control" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">END_DATE</label>
                                    <input type="date" name="endDate" th:value="${r.endDate != null ? #temporals.format(r.endDate, 'yyyy-MM-dd') : ''}" class="form-control">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">PAY_DAY</label>
                                    <input type="number" name="payDay" th:value="${r.payDay}" class="form-control" min="1" max="31" required>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label">BASE_AMT</label>
                                    <input type="number" name="baseAmt" th:value="${r.baseAmt}" class="form-control" step="0.01" min="0">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">MEAL_AMT</label>
                                    <input type="number" name="mealAmt" th:value="${r.mealAmt}" class="form-control" step="0.01" min="0">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">TRANS_AMT</label>
                                    <input type="number" name="transAmt" th:value="${r.transAmt}" class="form-control" step="0.01" min="0">
                                </div>

                                <div class="col-md-3">
                                    <label class="form-label">PEN_RATE</label>
                                    <input type="number" name="penRate" th:value="${r.penRate}" class="form-control" step="0.0001" min="0" max="1">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">HLTH_RATE</label>
                                    <input type="number" name="hlthRate" th:value="${r.hlthRate}" class="form-control" step="0.0001" min="0" max="1">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">EMP_RATE</label>
                                    <input type="number" name="empRate" th:value="${r.empRate}" class="form-control" step="0.0001" min="0" max="1">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">TAX_RATE</label>
                                    <input type="number" name="taxRate" th:value="${r.taxRate}" class="form-control" step="0.0001" min="0" max="1">
                                </div>

                                <div class="col-md-3">
                                    <label class="form-label">STATUS</label>
                                    <select name="status" class="form-select">
                                        <option value="ACTIVE" th:selected="${r.status.name() == 'ACTIVE'}">ACTIVE</option>
                                        <option value="INACTIVE" th:selected="${r.status.name() == 'INACTIVE'}">INACTIVE</option>
                                    </select>
                                </div>

                                <div class="col-12">
                                    <label class="form-label">REMARK</label>
                                    <textarea name="remark" class="form-control" rows="2" th:text="${r.remark}"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" type="submit">저장</button>
                            <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">닫기</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>