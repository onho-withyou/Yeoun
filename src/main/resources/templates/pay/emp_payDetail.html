<th:block xmlns:th="http://www.thymeleaf.org"
          xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
          layout:decorate="~{layouts/layout}">

<th:block layout:fragment="content">
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --line:#e6eaf2;
    --text:#0f172a;
    --muted:#475569;
    --subtle:#64748b;
    --accent:#0ea5a4;
    --accent-strong:#0d9488;
    --accent-soft:#ccfbf1;
    --head:#f1f5f9;
  }
  body{margin:0;background:var(--bg);font-family:"Noto Sans KR";}
  .container{max-width:1200px;margin:0 auto;padding:18px 20px}  
  .grid{display:grid;gap:18px}
  .two{grid-template-columns:1fr 1fr}
  @media(max-width:980px){.two{grid-template-columns:1fr}}
  .panel,.card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:16px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px 12px;border-bottom:1px solid var(--line)}
  th{background:var(--head)}
  .right{text-align:right}
  .muted{color:#64748b}
  .mini{font-size:12px}
  .btn{padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
  .btn-ghost{border:1px solid var(--line);background:#fff}
  .btn-soft{background:var(--accent-soft);border:1px solid #99f6e4}
</style>


<div class="container-xxl py-4">

  <div class="container d-flex justify-content-between align-items-center mb-4">

    <!-- ì™¼ìª½: ì œëª© -->
    <div>
        <h1 class="m-0 fw-bold">ê¸‰ì—¬ ëª…ì„¸ì„œ ì¡°íšŒ</h1>
       
    </div>

    <!-- ì˜¤ë¥¸ìª½: ë²„íŠ¼/ë‚ ì§œ ì„ íƒ ì˜ì—­ -->
    <div class="d-flex align-items-center gap-2">

        <a th:href="@{|/pay/emp_pay?yymm=${prev}|}" 
           class="btn btn-outline-secondary btn-sm">â—€ ì´ì „</a>

        <input id="month" type="month"
               class="form-control form-control-sm"
               style="width:130px; height:60px;"
               th:value="${#strings.substring(yymm,0,4)} + '-' + ${#strings.substring(yymm,4,6)}">

        <a th:href="@{|/pay/emp_pay?yymm=${next}|}" 
           class="btn btn-outline-secondary btn-sm">ë‹¤ìŒ â–¶</a>

      <!-- PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
      <input type="hidden" id="payslipId" th:value="${payslipId}">
      
		<button class="btn btn-soft pdf-btn"
		        th:if="${payslipId != null}"
		        th:onclick="'window.open(\'/pay/pdf/' + ${payslipId} + '\', \'_blank\');'">
		    ğŸ–¨ PDF ì €ì¥
		</button>

       


    </div>
</div>


  <!-- ########## ì‹ ê·œ ì¶”ê°€: header nullì¼ ë•Œ ì²˜ë¦¬ ########## -->
  <section th:if="${header == null}">
    <div class="panel" style="text-align:center; padding:40px">
      <h2 th:text="${error != null ? error : 'ê¸‰ì—¬ëª…ì„¸ì„œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'}"></h2>
      <p class="muted">ì„ íƒí•œ ì›”ì— ëŒ€í•œ ê¸‰ì—¬ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>

      <a th:href="@{/pay/emp_pay}" class="btn btn-ghost" style="margin-top:12px">í˜„ì¬ì›”ë¡œ ì´ë™</a>
    </div>
    <!-- header ì—†ìœ¼ë©´ ì•„ë˜ ë³¸ë¬¸ ì „ì²´ ë Œë”ë§ ì•ˆí•¨ -->
    <div style="display:none" ></div>
  </section>



  <!-- ########## header ìˆì„ ë•Œë§Œ ëª…ì„¸ì„œ ë³¸ë¬¸ ì¶œë ¥ ########## -->
  <section th:if="${header != null}">

    <!-- Summary -->
<section class="row g-3">

  <!-- ì™¼ìª½: ì‹¤ìˆ˜ë ¹ì•¡ -->
  <div class="col-md-6">
    <div class="card shadow-sm p-4">

      <div class="text-muted fw-semibold mb-2"
           th:text="${#strings.substring(yymm,0,4)} + 'ë…„ ' + ${#strings.substring(yymm,4,6)} + 'ì›”'">
      </div>

      <div class="text-secondary fw-bold mb-1">ì‹¤ìˆ˜ë ¹ì•¡</div>

      <div class="fw-bold fs-3 text-primary"
     th:text="'â‚©' + ${#numbers.formatInteger(header.netAmt,3,'COMMA')}">
	</div>


    </div>
  </div>


  <!-- ì˜¤ë¥¸ìª½: ì‚¬ì› ì •ë³´ -->
  <div class="col-md-6">
    <div class="card shadow-sm p-4">

      <div class="d-flex justify-content-between align-items-start">

        <div>
          <h4 class="fw-bold mb-1" th:text="${header.empName}"></h4>

          <span class="badge bg-primary mb-2"
                th:text="${header.posName}"></span>

          <div class="text-muted mt-2">
            ë¶€ì„œ:
            <span class="fw-semibold" th:text="${header.deptName}"></span>
            Â· ì‚¬ë²ˆ:
            <span class="fw-semibold" th:text="${header.empId}"></span>
          </div>
        </div>

      </div>

    </div>
  </div>

</section>

    <!-- ì§€ê¸‰ / ê³µì œ -->
    <section class="grid two">

      <!-- ì§€ê¸‰ í•­ëª© -->
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h3>ì§€ê¸‰ í•­ëª©</h3>
          <span class="muted mini"
                th:text="${#lists.size(items.?[type=='ALW'])} + 'ê°œ'"></span>
        </div>

        <table>
          <thead><tr><th>í•­ëª©</th><th class="right">ê¸ˆì•¡</th><th class="right">ë¹„ê³ </th></tr></thead>
          <tbody>
            <tr th:each="i : ${items}" th:if="${i.type=='ALW'}">
              <td th:text="${i.itemName}"></td>
              <td class="right" th:text="'â‚©' + ${#numbers.formatInteger(i.amount,3,'COMMA')}"></td>
              <td class="right muted"></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <th>ì†Œê³„</th>
              <th class="right"
			    th:text="'â‚©' + ${#numbers.formatInteger(header.baseAmt + header.alwAmt, 3, 'COMMA')}">
			</th>

              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>


      <!-- ê³µì œ í•­ëª© -->
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h3>ê³µì œ í•­ëª©</h3>
          <span class="muted mini"
                th:text="${#lists.size(items.?[type=='DED'])} + 'ê°œ'"></span>
        </div>

        <table>
          <thead><tr><th>í•­ëª©</th><th class="right">ê¸ˆì•¡</th><th class="right">ë¹„ê³ </th></tr></thead>
          <tbody>
            <tr th:each="i : ${items}" th:if="${i.type=='DED'}">
              <td th:text="${i.itemName}"></td>
              <td class="right" th:text="'â‚©' + ${#numbers.formatInteger(i.amount,3,'COMMA')}"></td>
              <td class="right muted"></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <th>ì†Œê³„</th>
              <th class="right"
                  th:text="'â‚©' + ${#numbers.formatInteger(header.dedAmt,3,'COMMA')}"></th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>

    </section>

  </section> <!-- header != null END -->

</div>



</th:block>
</th:block>
