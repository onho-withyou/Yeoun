<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê¸‰ì—¬ ì´ë ¥ ì¡°íšŒ</title>

    <!-- AG Grid -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-grid.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-theme-alpine.css" />

    <style>
        .tab-button { padding:10px 15px; border:1px solid #ccc; cursor:pointer; background:#eee; }
        .tab-button.active { background:white; border-bottom:none; }
        .tab-content { display:none; padding:15px; border:1px solid #ddd; margin-top:-1px; }
        .tab-content.active { display:block; }
    </style>
</head>

<body>

<h1>ğŸ’° ê¸‰ì—¬ ì´ë ¥ ì¡°íšŒ</h1>

<div class="main-container">

    <!-- ğŸ”¥ íƒ­ -->
    <div class="tab-controls">
        <button class="tab-button active" data-tab="emp">ì‚¬ì› ê¸°ì¤€ ì¡°íšŒ</button>
        <button class="tab-button" data-tab="dept">ë¶€ì„œ ê¸°ì¤€ ì¡°íšŒ</button>
        <button class="tab-button" data-tab="month">ì›”ë³„ í†µí•© ì¡°íšŒ</button>
    </div>

    <!-- ğŸ”¥ ê²€ìƒ‰ FORM -->
    <form th:action="@{/pay/history}" method="get">

        <input type="hidden" name="mode" id="mode" th:value="${param.mode != null ? param.mode : 'emp'}">

        <!-- â­ ì‚¬ì› ê¸°ì¤€ -->
        <div id="emp" class="tab-content active">
            <label>ì‚¬ë²ˆ/ì‚¬ì›ëª…:</label>
            <input type="text" name="keyword" th:value="${param.keyword}">

            <label>ì—°ë„:</label>
            <select name="yearEmp">
                <option value="">ì „ì²´</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
            </select>

            <label>ì›”:</label>
            <select name="monthEmp">
                <option value="">ì „ì²´</option>
                <option value="01">1ì›”</option>
                <option value="02">2ì›”</option>
                <option value="03">3ì›”</option>
            </select>
        </div>

        <!-- â­ ë¶€ì„œ ê¸°ì¤€ -->
        <div id="dept" class="tab-content">
            <label>ë¶€ì„œëª…:</label>
            <input type="text" name="deptName" th:value="${param.deptName}">

            <label>ì—°ë„:</label>
            <select name="yearDept">
                <option value="">ì „ì²´</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
            </select>

            <label>ì›”:</label>
            <select name="monthDept">
                <option value="">ì „ì²´</option>
                <option value="01">1ì›”</option>
                <option value="02">2ì›”</option>
                <option value="03">3ì›”</option>
            </select>
        </div>

        <!-- â­ ì›”ë³„ ê¸°ì¤€ -->
        <div id="month" class="tab-content">
            <label>ì—°ë„:</label>
            <select name="yearMonth">
                <option value="">ì „ì²´</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
            </select>

            <label>ì›”:</label>
            <select name="monthMonth">
                <option value="01">1ì›”</option>
                <option value="02">2ì›”</option>
                <option value="03">3ì›”</option>
            </select>
        </div>

        <button type="submit">ê²€ìƒ‰</button>
        <button type="reset" onclick="location.href='/pay/history'">ì´ˆê¸°í™”</button>
    </form>


    <!-- ğŸ”¥ AG Grid ì˜ì—­ -->
    <div id="payslipGrid" class="ag-theme-alpine mt-3"
         style="height: 420px; width: 100%; margin-top:20px;"></div>

</div>


<!-- ğŸ”¥ AG Grid Script -->
<script th:inline="javascript">

/*<![CDATA[*/

const slips = /*[[${slips}]]*/ [];

function numberWithCommas(x) {
  if (x == null) return '';
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function renderStatusBadge(status) {
  if (!status) return "";
  return `<span class="badge bg-info">${status}</span>`;
}

// ğŸ”¹ AG Grid ì»¬ëŸ¼ ì •ì˜
const columnDefs = [
  { headerName: "ì‚¬ë²ˆ", field: "empId", sortable: true, filter: true, width: 120 },
  { headerName: "ì´ë¦„", field: "empName", sortable: true, filter: true, width: 140 },
  { headerName: "ë¶€ì„œ", field: "deptName", sortable: true, filter: true, width: 140 },
  {
    headerName: "ì´ì§€ê¸‰ì•¡", field: "totAmt", width: 140,
    valueFormatter: p => numberWithCommas(p.value),
    cellStyle: { textAlign: 'right' }
  },
  {
    headerName: "ì‹¤ìˆ˜ë ¹ì•¡", field: "netAmt", width: 140,
    valueFormatter: p => numberWithCommas(p.value),
    cellStyle: { fontWeight: "600", textAlign:'right', color:'#0d6efd' }
  },
  {
    headerName: "ìƒíƒœ", field: "calcStatus", width:120,
    cellRenderer: p => renderStatusBadge(p.value),
    cellStyle: { textAlign: 'center' }
  }
];

// ğŸ”¹ AG Grid ì˜µì…˜
const gridOptions = {
  columnDefs: columnDefs,
  rowData: slips,
  pagination: true,
  paginationPageSize: 20,
};

// ğŸ”¹ Grid í‘œì‹œ
document.addEventListener('DOMContentLoaded', () => {
  const gridDiv = document.querySelector('#payslipGrid');
  new agGrid.Grid(gridDiv, gridOptions);
});

/*]]>*/

</script>


<!-- ğŸ”¥ íƒ­ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
document.querySelectorAll(".tab-button").forEach(btn => {
    btn.addEventListener("click", () => {

        document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));

        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");

        document.getElementById("mode").value = btn.dataset.tab;
    });
});
</script>

</body>
</html>
