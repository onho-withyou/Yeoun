<th:block xmlns:th="http://www.thymeleaf.org"
          xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
          layout:decorate="~{/layouts/layout.html}">
<body>
<th:block layout:fragment="content">

	<div class="container-xxl d-flex justify-content-center align-items-center" style="min-height: 75vh;">

    	<div class="card shadow-sm" style="width: 420px; border-radius: 12px;">
      		<div class="card-body p-4">

        		<h4 class="mb-4 text-center">비밀번호 변경</h4>

        		<form th:action="@{/my/password}" th:object="${passwordChangeDTO}" method="post">

		        	<!-- 현재 비밀번호 -->
		          	<div class="mb-3">
		            	<label class="form-label fw-semibold">현재 비밀번호</label>
		            	<div class="position-relative">
		              		<input type="password" th:field="*{currentPassword}" class="form-control pe-5"
		                     	   id="currentPassword" placeholder="현재 비밀번호를 입력하세요">
		              
		              		<i class='bx bx-hide position-absolute top-50 end-0 translate-middle-y me-3' 
		                 		style="font-size: 22px; cursor: pointer; color: #6c757d;"
		                 		onclick="togglePassword('currentPassword', this)"></i>
		            	</div>
		            	<div class="text-danger small" th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}"></div>
		          	</div>
		
		         	<!-- 새 비밀번호 -->
		          	<div class="mb-3">
		            	<label class="form-label fw-semibold">새 비밀번호</label>
		            	<div class="position-relative">
		              		<input type="password" th:field="*{newPassword}" class="form-control pe-5"
		                     	   id="newPassword" maxlength="20" placeholder="새 비밀번호를 입력하세요">
		              
		              		<i class='bx bx-hide position-absolute top-50 end-0 translate-middle-y me-3' 
		                 	   style="font-size: 22px; cursor: pointer; color: #6c757d;"
		                 	   onclick="togglePassword('newPassword', this)"></i>
		            	</div>
		            	<div class="text-danger small" th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}"></div>
		          	</div>
		
		          	<!-- 새 비밀번호 확인 -->
		          	<div class="mb-3">
		            	<label class="form-label fw-semibold">새 비밀번호 확인</label>
		            	<div class="position-relative">
		              		<input type="password" th:field="*{confirmPassword}" class="form-control pe-5" 
		                     	   id="confirmPassword" maxlength="20" placeholder="새 비밀번호를 다시 입력하세요">
		              
		              		<i class='bx bx-hide position-absolute top-50 end-0 translate-middle-y me-3' 
		                 	   style="font-size: 22px; cursor: pointer; color: #6c757d;"
		                	   onclick="togglePassword('confirmPassword', this)"></i>
		            	</div>
		            	<div class="text-danger small" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
		          	</div>
		
		          	<!-- 성공 메시지 -->
		          	<div class="alert alert-success text-center mx-auto" th:if="${successMessage}"
		               	 th:text="${successMessage}" style="font-size: 16px;">
		          	</div>
		
		          	<button type="submit" class="btn btn-primary w-100 mt-3">
		            	비밀번호 변경
		          	</button>
       			</form>

      		</div>
    	</div>

	</div>

</th:block>
</body>
</th:block>

<script th:inline="javascript">
const logoutAfterChange = /*[[${logoutAfterChange}]]*/ false;

if (logoutAfterChange) {
	alert('비밀번호가 변경되었습니다.\n다시 로그인해주세요.');
    const form = document.getElementById('hiddenLogoutForm');
    if (form) {
    	form.submit();
    } else {
     	 window.location.href = /*[[@{/logout}]]*/ '/logout';
    }
}
</script>
<script>
function togglePassword(inputId, iconEl) {
	const input = document.getElementById(inputId);
    
    if (input.type === 'password') {
    	input.type = 'text';
	    iconEl.classList.remove('bx-hide');
	    iconEl.classList.add('bx-show');
    } else {
	    input.type = 'password';
	    iconEl.classList.remove('bx-show');
	    iconEl.classList.add('bx-hide');
    }
}
</script>